---
layout: post
title: "关于椭圆的研究"
date:   2024-11-15
tags: [ellipse]
comments: true
author: mwwz
---

## 点到椭圆的距离

halcon的形状匹配算法执行速度极快，以下面这张图为例，分辨率:2448×2048(500万像素)，角度范围:360°，亚像素:least_squares，halcon仅用了10ms左右，如果在程序中调用，最短仅需5 - 6ms，halcon是如何做到的呢？其底层运用了哪些技术与方法呢？

<!-- more --> 

$$
\begin{align}x^4+ax^3+bx^2+cx+d=(x^2+p_1x+q_1)(x^2+p_2x+q_2)\end{align}
$$

![](https://mwwzq.github.io/images/ellipse_dist1.png)

![](https://mwwzq.github.io/images/ellipse_dist3.png)

关于最短距离，也可以用其他方法去近似，毕竟求解一元四次方程的代价是昂贵的，大概有两个办法去近似，这在halcon中的[dist_ellipse_contour_xld 算子](https://www.mvtec.com/doc/halcon/12/en/dist_ellipse_contour_xld.html)也有提到，一种是使用PF1+PF2-2a代替；一种是使用点P与点Q的距离代替，Q为PF1、PF2的角平分线与椭圆交点。其中F1、F2是椭圆的两个焦点。此外还有一种办法，就是Sampson Error，定义如下

![](https://mwwzq.github.io/images/SampsonError.png)

## 椭圆周长

椭圆周长公式如下，实际上是一个定积分计算，不会计算的可以使用boost库， 除了能够得到椭圆周长的精确值，定积分的计算也可以解决椭圆等分问题，等分之后，椭圆每一段的弧长都相等，这在建立椭圆卡尺时很有用。

$$
\begin{align} C&=4\int_{0}^{\frac{\pi}{2}}\sqrt{a^2sin^{2}(\theta)+b^2cos^{2}(\theta)}d\theta\\ &=4\int_{0}^{\frac{\pi}{2}}\sqrt{a^2(1-cos^{2}(\theta))+b^2cos^{2}(\theta)}d\theta\\ &=4\int_{0}^{\frac{\pi}{2}}\sqrt{1-e^2cos^{2}(\theta)}d\theta  \\
&=4\int_{0}^{\frac{\pi}{2}}\sqrt{1-e^2sin^{2}(\theta)}d\theta\end{align}
$$

![](https://mwwzq.github.io/images/ellipse_divide.png)

## 椭圆拟合

opencv里的椭圆拟合函数并不是很好使，参照文献[Numerically Stable Direct Least Squares Fitting of Ellipses](https://www.semanticscholar.org/paper/Numerically-Stable-Direct-Least-Squares-Fitting-of-oy-Flusser/9a8607575ba9c6016e9f3db5e52f5ed4d14d5dfd)实现会好很多，该方法是数值稳定的，对于只占椭圆很小一段比例的圆弧效果很好。

![](https://mwwzq.github.io/images/ellipse_fit.png)

![](https://mwwzq.github.io/images/ellipse_fit2.png)
